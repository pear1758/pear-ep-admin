import{d as S,r as I,h as p,j as h,K as Y,L as W,_ as $,c as Z,A as z,I as O,J as ee,B,k as te,s as b,e as x,Q as k,u as L,S as T,U as se,V as F,W as q}from"./index-b2c0d808.js";const oe=S({__name:"Dragger",props:{onFile:{type:Function,required:!0}},setup(i){const r=i,s=I(!1),y=(f,l)=>{f.preventDefault(),s.value=l},C=f=>{var o;f.preventDefault(),s.value=!1;const l=((o=f.dataTransfer)==null?void 0:o.files)||[];r.onFile(l)};return(f,l)=>(p(),h("div",{class:W(["dragger-box",{"is-dragover":s.value}]),onDragover:l[0]||(l[0]=o=>y(o,!0)),onDragleave:l[1]||(l[1]=o=>y(o,!1)),onDrop:C},[Y(f.$slots,"default",{},void 0,!0)],34))}}),ne=$(oe,[["__scopeId","data-v-6968bb40"]]),ae={class:"upload-box"},ie=["onClick"],le=["src"],ce=["onClick"],re=["onClick"],de=["onClick"],ue=["onClick"],pe=["accept"],fe=S({name:"Upload",__name:"Upload",props:{fileList:{type:Array,default:[]},action:{type:String,require:!0},activeIndex:{type:Number},maxLength:{type:Number,default:10},showReplace:{type:Boolean,default:!1},showActive:{type:Boolean,default:!1},beforeUpload:{type:Function},onProgress:{type:Function},onSuccess:{type:Function},onError:{type:Function},onChange:{type:Function},onRemove:{type:Function},headers:{type:Object},name:{type:String,default:"file"},data:{type:Object},withCredentials:{type:Boolean,default:!1},accept:{type:String}},emits:["update:fileList","update:activeIndex"],setup(i,{emit:r}){const s=i;s.showActive&&s.activeIndex==null&&console.error("未绑定activeIndex");const y=I(!1),C=I(0),f=Z(()=>s.fileList.map(t=>t.src));let l="add",o;const d=I(),v=()=>{L(d).click()},J=t=>{const e=t.target.files;e&&(E(e),L(d).value="")},E=t=>{Array.from(t).forEach(u=>{if(!s.beforeUpload){D(u);return}const a=s.beforeUpload(u);a&&(a instanceof Promise&&a.then(_=>D(_)),D(u))})},U=(t,e)=>{const u=s.fileList.map(a=>a.uid===t.uid?{...a,...e}:a);r("update:fileList",u)},D=t=>{const e={uid:Date.now()+"upload-file",name:t.name,size:t.size,percent:0,status:"ready",raw:t,src:"",response:null},u=new FileReader;u.readAsDataURL(t),u.onload=a=>{var M;const _=(M=a.target)==null?void 0:M.result;e.src=_;const n=T(s.fileList);l=="add"&&n.push(e),l=="replace"&&(n[o]=e),r("update:fileList",n),l="add";const{name:g,data:m,action:G,headers:H,withCredentials:X,onProgress:N,onSuccess:V,onError:j,onChange:w}=s,A=new FormData;A.append(g,t),m&&Object.keys(m).forEach(c=>A.append(c,m[c])),se.post(G,A,{headers:{...H,"Content-Type":"multipart/form-data"},withCredentials:X,onUploadProgress:c=>{const R=Math.round(c.loaded*100/c.total)||0;U(e,{percent:R,status:"uploading"}),e.status="uploading",e.percent=R,N&&N(R,e)}}).then(c=>{console.log("--成功--",c),U(e,{status:"success",response:c.data}),e.status="success",e.response=c.data,V&&V(c.data,e),w&&w(e)}).catch(c=>{console.log("err",c),U(e,{status:"error",error:c}),e.status="error",e.error=c,j&&j(c,e),w&&w(e)})}},K=t=>{o=t,l="replace",v()},P=t=>{const e=T(s.fileList);if(s.showActive){const a=t<s.activeIndex,_=!!(t==s.activeIndex&&t==e.length-1&&e[t-1]);if(a||_){let n=s.activeIndex;n--,r("update:activeIndex",n)}}const u=e.splice(t,1);r("update:fileList",e),s.onRemove&&s.onRemove(u[0])},Q=t=>{C.value=t,y.value=!0};return(t,e)=>{const u=z("el-progress"),a=z("Iconify"),_=z("img-viewer");return p(),h("div",ae,[(p(!0),h(O,null,ee(i.fileList,(n,g)=>(p(),h("div",{key:n.uid,class:W(["uploaded",{active:i.showActive&&i.activeIndex==g}]),onClick:m=>i.showActive&&r("update:activeIndex",g)},[["ready","uploading"].includes(n.status)?(p(),B(u,{key:0,type:"circle",percentage:n.percent},null,8,["percentage"])):k("",!0),["success",void 0].includes(n.status)?(p(),h(O,{key:1},[b("img",{class:"img",src:n.src},null,8,le),i.showReplace?(p(),h("div",{key:0,class:"replace-box",onClick:F(m=>K(g),["stop"])},"替换图片",8,ce)):k("",!0),i.showActive&&i.activeIndex==g?(p(),h("div",{key:1,class:"select-del-icon",onClick:F(m=>P(g),["stop"])},[x(a,{icon:"close"})],8,re)):k("",!0),g!==i.activeIndex?(p(),h("div",{key:2,class:"hover-del-icon",onClick:F(m=>P(g),["stop"])},[x(a,{icon:"delete"})],8,de)):k("",!0),b("div",{class:"hover-preview-icon",onClick:F(m=>Q(g),["stop"])},[x(a,{icon:"zoom-in"})],8,ue)],64)):k("",!0),["error"].includes(n.status)?(p(),B(u,{key:2,type:"circle",percentage:n.percent,status:"exception"},null,8,["percentage"])):k("",!0)],10,ie))),128)),i.fileList.length<i.maxLength?(p(),B(ne,{key:0,onFile:n=>E(n)},{default:te(()=>[b("div",{class:"upload",onClick:v},[x(a,{icon:"plus"})])]),_:1},8,["onFile"])):k("",!0),b("input",{class:"file-input",style:{display:"none"},ref_key:"fileInputRef",ref:d,onChange:J,type:"file",accept:i.accept,multiple:!1},null,40,pe),x(_,{visible:y.value,"onUpdate:visible":e[0]||(e[0]=n=>y.value=n),imgList:f.value,initIndex:C.value},null,8,["visible","imgList","initIndex"])])}}}),ve=$(fe,[["__scopeId","data-v-77f8ec69"]]),ge={class:"page-box bg-white dark:bg-dark p-4"},he=S({__name:"fileUpload",setup(i){const r=I([]),s=I(0),y=o=>o.size/1024>12e3?(console.log("file-to-big 超过了12M"),!1):!0,C=o=>{console.log("onFileChange-size",o.size/1024)},f=(o,d)=>{String(o==null?void 0:o.code).startsWith("200")||(q.error((o==null?void 0:o.msg)||"上传失败"),r.value=L(r).filter(v=>v.uid!==d.uid))},l=(o,d)=>{q.error("上传失败"),r.value=L(r).filter(v=>v.uid!==d.uid)};return(o,d)=>(p(),h("div",ge,[x(L(ve),{"file-list":r.value,"onUpdate:fileList":d[0]||(d[0]=v=>r.value=v),"active-index":s.value,"onUpdate:activeIndex":d[1]||(d[1]=v=>s.value=v),action:"/dev-api/sourceData/document/uploadFile","before-upload":y,"on-change":C,"on-success":f,"on-error":l,headers:{key:"xxxxx"},showReplace:"",showActive:""},null,8,["file-list","active-index"])]))}});const me=$(he,[["__scopeId","data-v-d61f3c32"]]);export{me as default};
