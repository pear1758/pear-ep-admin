import{c as O,g as $,d as R,aK as U,bq as q,aP as _,o as k,a as N,bu as b,I as y,H as P,w as L,b as z,aN as F,F as G,u as j,bM as T,bN as H,bL as W,bH as V,bC as K,b1 as Z}from"./index-ClfDdxmO.js";import{u as Q}from"./platformConfig-BbUJI7GN.js";var B={exports:{}};(function(I,M){(function(f,g){I.exports=g()})(O,function(){function f(e){var d=[];return e.AMapUI&&d.push(g(e.AMapUI)),e.Loca&&d.push(A(e.Loca)),Promise.all(d)}function g(e){return new Promise(function(d,l){var r=[];if(e.plugins)for(var a=0;a<e.plugins.length;a+=1)i.AMapUI.plugins.indexOf(e.plugins[a])==-1&&r.push(e.plugins[a]);if(n.AMapUI===o.failed)l("前次请求 AMapUI 失败");else if(n.AMapUI===o.notload){n.AMapUI=o.loading,i.AMapUI.version=e.version||i.AMapUI.version,a=i.AMapUI.version;var s=document.body||document.head,u=document.createElement("script");u.type="text/javascript",u.src="https://webapi.amap.com/ui/"+a+"/main.js",u.onerror=function(t){n.AMapUI=o.failed,l("请求 AMapUI 失败")},u.onload=function(){if(n.AMapUI=o.loaded,r.length)window.AMapUI.loadUI(r,function(){for(var t=0,p=r.length;t<p;t++){var c=r[t].split("/").slice(-1)[0];window.AMapUI[c]=arguments[t]}for(d();v.AMapUI.length;)v.AMapUI.splice(0,1)[0]()});else for(d();v.AMapUI.length;)v.AMapUI.splice(0,1)[0]()},s.appendChild(u)}else n.AMapUI===o.loaded?e.version&&e.version!==i.AMapUI.version?l("不允许多个版本 AMapUI 混用"):r.length?window.AMapUI.loadUI(r,function(){for(var t=0,p=r.length;t<p;t++){var c=r[t].split("/").slice(-1)[0];window.AMapUI[c]=arguments[t]}d()}):d():e.version&&e.version!==i.AMapUI.version?l("不允许多个版本 AMapUI 混用"):v.AMapUI.push(function(t){t?l(t):r.length?window.AMapUI.loadUI(r,function(){for(var p=0,c=r.length;p<c;p++){var m=r[p].split("/").slice(-1)[0];window.AMapUI[m]=arguments[p]}d()}):d()})})}function A(e){return new Promise(function(d,l){if(n.Loca===o.failed)l("前次请求 Loca 失败");else if(n.Loca===o.notload){n.Loca=o.loading,i.Loca.version=e.version||i.Loca.version;var r=i.Loca.version,a=i.AMap.version.startsWith("2"),s=r.startsWith("2");if(a&&!s||!a&&s)l("JSAPI 与 Loca 版本不对应！！");else{a=i.key,s=document.body||document.head;var u=document.createElement("script");u.type="text/javascript",u.src="https://webapi.amap.com/loca?v="+r+"&key="+a,u.onerror=function(t){n.Loca=o.failed,l("请求 AMapUI 失败")},u.onload=function(){for(n.Loca=o.loaded,d();v.Loca.length;)v.Loca.splice(0,1)[0]()},s.appendChild(u)}}else n.Loca===o.loaded?e.version&&e.version!==i.Loca.version?l("不允许多个版本 Loca 混用"):d():e.version&&e.version!==i.Loca.version?l("不允许多个版本 Loca 混用"):v.Loca.push(function(t){t?l(t):l()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(o||(o={}));var i={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},v={AMap:[],AMapUI:[],Loca:[]},w=[],C=function(e){typeof e=="function"&&(n.AMap===o.loaded?e(window.AMap):w.push(e))};return{load:function(e){return new Promise(function(d,l){if(n.AMap==o.failed)l("");else if(n.AMap==o.notload){var r=e.key,a=e.version,s=e.plugins;r?(window.AMap&&location.host!=="lbs.amap.com"&&l("禁止多种API加载方式混用"),i.key=r,i.AMap.version=a||i.AMap.version,i.AMap.plugins=s||i.AMap.plugins,n.AMap=o.loading,a=document.body||document.head,window.___onAPILoaded=function(t){if(delete window.___onAPILoaded,t)n.AMap=o.failed,l(t);else for(n.AMap=o.loaded,f(e).then(function(){d(window.AMap)}).catch(l);w.length;)w.splice(0,1)[0]()},s=document.createElement("script"),s.type="text/javascript",s.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+i.AMap.version+"&key="+r+"&plugin="+i.AMap.plugins.join(","),s.onerror=function(t){n.AMap=o.failed,l(t)},a.appendChild(s)):l("请填写key")}else if(n.AMap==o.loaded)if(e.key&&e.key!==i.key)l("多个不一致的 key");else if(e.version&&e.version!==i.AMap.version)l("不允许多个版本 JSAPI 混用");else{if(r=[],e.plugins)for(a=0;a<e.plugins.length;a+=1)i.AMap.plugins.indexOf(e.plugins[a])==-1&&r.push(e.plugins[a]);r.length?window.AMap.plugin(r,function(){f(e).then(function(){d(window.AMap)}).catch(l)}):f(e).then(function(){d(window.AMap)}).catch(l)}else if(e.key&&e.key!==i.key)l("多个不一致的 key");else if(e.version&&e.version!==i.AMap.version)l("不允许多个版本 JSAPI 混用");else{var u=[];if(e.plugins)for(a=0;a<e.plugins.length;a+=1)i.AMap.plugins.indexOf(e.plugins[a])==-1&&u.push(e.plugins[a]);C(function(){u.length?window.AMap.plugin(u,function(){f(e).then(function(){d(window.AMap)}).catch(l)}):f(e).then(function(){d(window.AMap)}).catch(l)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,i={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},v={AMap:[],AMapUI:[],Loca:[]}}}})})(B);var X=B.exports;const Y=$(X),ee=""+new URL("../png/marker-JPCZIn3M.png",import.meta.url).href,oe={class:"map-box"},ae={class:"mt-1.5"},ne=R({name:"mapAddrDrawer",__name:"addrDrawer",props:{visible:{type:Boolean,required:!0},mapData:{validator:()=>!0,required:!0}},emits:["update:visible","update:mapData"],setup(I,{emit:M}){const f=I,g=U(),A=U("");let o,i,n={addr:"",lng:"",lat:""};const v=U([]);q(async()=>{if(f.visible){if(await e(),!H(f.mapData))return;n=W(f.mapData),Reflect.has(n,"lng")||(n.lng=""),Reflect.has(n,"lat")||(n.lat=""),Reflect.has(n,"addr")||(n.addr="");const{addr:a,lng:s,lat:u}=n;A.value=a,s&&u&&d([Number(s),Number(u)],a);return}o!=null&&o.destroy()&&(o==null||o.clearEvents("click")),v.value.splice(0)});const w=()=>{M("update:visible",!1)},C=()=>{w(),M("update:mapData",n)};function e(){const{securityJsCode:a,key:s}=Q().mapConfig;return new Promise((u,t)=>{window._AMapSecurityConfig={securityJsCode:a},Y.load({key:s,version:"2.0",plugins:["AMap.Geocoder","AMap.AutoComplete"]}).then(p=>{var c,m;o=new p.Map(g.value,{zoom:15,layers:[new p.TileLayer.Satellite,new p.TileLayer.RoadNet],center:[((c=f.mapData)==null?void 0:c.lng)||104.060791,((m=f.mapData)==null?void 0:m.lat)||30.543995]}),i=new p.Geocoder,o.on("click",h=>{const x=h.lnglat.getLng(),D=h.lnglat.getLat(),S=[x,D];if(!x||!D){V.warning("打点失败");return}i.getAddress(S,function(J,E){J==="complete"&&E.regeocode?(A.value=E.regeocode.formattedAddress,o.clearMap(),d(S,A.value,!1),n={addr:A.value,lng:x,lat:D}):V.error("根据经纬度查询地址失败")})}),u()}).catch(p=>{console.log("err",p),t()})})}const d=(a,s,u=!0)=>{const t=new AMap.Marker({position:a,icon:new AMap.Icon({image:ee,size:new AMap.Size(46,46),imageSize:new AMap.Size(46,46),imageOffset:new AMap.Pixel(0,9)}),anchor:"bottom-center"});t.setLabel({direction:"top",offset:new AMap.Pixel(0,9),content:`<div>${s||""}</div>`}),o.add(t),u&&o.setCenter(a)},l=a=>{if(console.log("query",a),!a){v.value=[];return}new AMap.Autocomplete({city:"全国"}).search(a,(u,t)=>{const{tips:p}=t;console.log("result",t),Array.isArray(p)&&(v.value=p.filter(c=>{var m,h;return((m=c.location)==null?void 0:m.lng)&&((h=c.location)==null?void 0:h.lat)}).map(c=>({label:c.name,value:c.name,lng:Number(c.location.lng),lat:Number(c.location.lat)})))})},r=a=>{const s=j(v).find(p=>p.value==a);if(!s)return;const{lng:u,lat:t}=s;d([u,t],a),n={addr:a,lng:u,lat:t}};return(a,s)=>{const u=_("el-option"),t=_("el-select"),p=_("el-button"),c=_("el-drawer");return k(),N(c,{modelValue:I.visible,title:"地址选择",onClose:w,size:422,class:"addr-drawer"},{footer:b(()=>[y(p,{onClick:w},{default:b(()=>[P("取消")]),_:1}),y(p,{type:"primary",onClick:C},{default:b(()=>[P("确定")]),_:1})]),default:b(()=>[L("div",oe,[y(t,{modelValue:A.value,"onUpdate:modelValue":s[0]||(s[0]=m=>A.value=m),placeholder:"输入查询或者点击选择",filterable:"",remote:"","remote-method":j(T)(l,700),style:{width:"100%"},onChange:r},{default:b(()=>[(k(!0),z(G,null,F(v.value,m=>(k(),N(u,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method"]),L("div",ae,[L("div",{id:"mapDiv",ref_key:"mapRef",ref:g},null,512)])])]),_:1},8,["modelValue"])}}}),te=K(ne,[["__scopeId","data-v-56fa8a11"]]),ie={class:"bg-white dark:bg-dark p-4"},le={class:"my-5"},re=R({__name:"mapAddrDrawer",setup(I){const M=U(!1),f=U(null),g=()=>{M.value=!0};return(A,o)=>{const i=_("el-button");return k(),z("div",ie,[y(i,{onClick:g},{default:b(()=>[P("点击打开")]),_:1}),L("div",le,[L("div",null,"数据: "+Z(f.value),1)]),y(te,{visible:M.value,"onUpdate:visible":o[0]||(o[0]=n=>M.value=n),"map-data":f.value,"onUpdate:mapData":o[1]||(o[1]=n=>f.value=n)},null,8,["visible","map-data"])])}}});export{re as default};
