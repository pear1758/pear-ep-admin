import{d as S,r as f,X as I,A as h,h as b,B as V,k as y,s as v,e as M,j as R,J as P,I as T,u as w,Y as j,Z as G,S as J,$ as O,a0 as q,W as N,_ as F,l as W,C as X}from"./index-858e4013.js";import{D as Y}from"./Drawer-1d07a23d.js";const Z=""+new URL("../png/marker-973dbddb.png",import.meta.url).href,H={class:"map-box"},K={class:"mt-1.5"},Q=S({name:"mapAddrDrawer",__name:"mapAddrDrawer",props:{visible:{type:Boolean,required:!0},mapData:{validator:()=>!0,required:!0}},emits:["update:visible","update:mapData"],setup(A,{emit:c}){const d=A,g=f(),i=f("");let a,_,o={addr:"",lng:"",lat:""};const u=f([]);I(async()=>{if(d.visible){if(await z(),!G(d.mapData))return;o=J(d.mapData),Reflect.has(o,"lng")||(o.lng=""),Reflect.has(o,"lat")||(o.lat=""),Reflect.has(o,"addr")||(o.addr="");const{addr:t,lng:l,lat:n}=o;i.value=t,l&&n&&D([Number(l),Number(n)],t);return}a!=null&&a.destroy()&&(a==null||a.clearEvents("click")),u.value.splice(0)});const B=()=>{c("update:mapData",o)};function z(){const{securityJsCode:t,key:l}=O().mapConfig;return new Promise((n,r)=>{window._AMapSecurityConfig={securityJsCode:t},q.load({key:l,version:"2.0",plugins:["AMap.Geocoder","AMap.AutoComplete"]}).then(e=>{var s,p;a=new e.Map(g.value,{zoom:15,layers:[new e.TileLayer.Satellite,new e.TileLayer.RoadNet],center:[((s=d.mapData)==null?void 0:s.lng)||104.060791,((p=d.mapData)==null?void 0:p.lat)||30.543995]}),_=new e.Geocoder,a.on("click",m=>{const k=m.lnglat.getLng(),C=m.lnglat.getLat(),x=[k,C];if(!k||!C){N.warning("打点失败");return}_.getAddress(x,function(E,L){E==="complete"&&L.regeocode?(i.value=L.regeocode.formattedAddress,a.clearMap(),D(x,i.value,!1),o={addr:i.value,lng:k,lat:C}):N.error("根据经纬度查询地址失败")})}),n()}).catch(e=>{console.log("err",e),r()})})}const D=(t,l,n=!0)=>{const r=new AMap.Marker({position:t,icon:new AMap.Icon({image:Z,size:new AMap.Size(46,46),imageSize:new AMap.Size(46,46),imageOffset:new AMap.Pixel(0,9)}),anchor:"bottom-center"});r.setLabel({direction:"top",offset:new AMap.Pixel(0,9),content:`<div>${l||""}</div>`}),a.add(r),n&&a.setCenter(t)},U=t=>{if(console.log("query",t),!t){u.value=[];return}new AMap.Autocomplete({city:"全国"}).search(t,(n,r)=>{const{tips:e}=r;console.log("result",r),Array.isArray(e)&&(u.value=e.filter(s=>{var p,m;return((p=s.location)==null?void 0:p.lng)&&((m=s.location)==null?void 0:m.lat)}).map(s=>({label:s.name,value:s.name,lng:Number(s.location.lng),lat:Number(s.location.lat)})))})},$=t=>{const l=w(u).find(e=>e.value==t);if(!l)return;const{lng:n,lat:r}=l;D([n,r],t),o={addr:t,lng:n,lat:r}};return(t,l)=>{const n=h("el-option"),r=h("el-select");return b(),V(w(Y),{modelValue:A.visible,"onUpdate:modelValue":l[1]||(l[1]=e=>c("update:visible",e)),title:"地址选择",onConfirm:B},{default:y(()=>[v("div",H,[M(r,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value=e),placeholder:"输入查询或者点击选择",filterable:"",remote:"","remote-method":w(j)(U,300),style:{width:"100%"},onChange:$},{default:y(()=>[(b(!0),R(T,null,P(u.value,e=>(b(),V(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method"]),v("div",K,[v("div",{id:"mapDiv",ref_key:"mapRef",ref:g},null,512)])])]),_:1},8,["modelValue"])}}}),ee=F(Q,[["__scopeId","data-v-2eaec6c3"]]),ae={class:"bg-white dark:bg-dark p-4"},te={class:"my-5"},ne=S({name:"selectAddrMap",__name:"selectAddrMap",setup(A){const c=f(!1),d=f(null),g=()=>{c.value=!0};return(i,a)=>{const _=h("el-button");return b(),R("div",ae,[M(_,{onClick:g},{default:y(()=>[W("点击打开")]),_:1}),v("div",te,[v("div",null,"数据: "+X(d.value),1)]),M(w(ee),{visible:c.value,"onUpdate:visible":a[0]||(a[0]=o=>c.value=o),"map-data":d.value,"onUpdate:mapData":a[1]||(a[1]=o=>d.value=o)},null,8,["visible","map-data"])])}}});export{ne as default};
