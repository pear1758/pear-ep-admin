import{d as S,aK as L,o as u,b as y,aO as Y,an as K,bC as E,s as Z,aP as $,F as T,aN as ee,a as B,bu as te,w as F,I as w,v as b,u as I,bL as q,bD as se,bz as U,bH as H}from"./index-CUD07q8U.js";import{u as oe,a as ne}from"./index-uGdeCMGa.js";const ae=S({__name:"dragger",props:{onFile:{type:Function,required:!0}},setup(i){const g=i,t=L(!1),h=(f,l)=>{f.preventDefault(),t.value=l},C=f=>{var p;f.preventDefault(),t.value=!1;const l=((p=f.dataTransfer)==null?void 0:p.files)||[];g.onFile(l)};return(f,l)=>(u(),y("div",{class:K(["dragger-box",{"is-dragover":t.value}]),onDragover:l[0]||(l[0]=p=>h(p,!0)),onDragleave:l[1]||(l[1]=p=>h(p,!1)),onDrop:C},[Y(f.$slots,"default",{},void 0,!0)],34))}}),ie=E(ae,[["__scopeId","data-v-14982a91"]]),le={class:"upload-box"},ce=["onClick"],re=["src"],de=["onClick"],ue=["onClick"],pe=["onClick"],fe=["onClick"],ve=["accept"],ge=S({name:"gkUpload",__name:"index",props:{fileList:{type:Array,default:[]},action:{type:String,require:!0},activeIndex:{type:Number},maxLength:{type:Number,default:10},showReplace:{type:Boolean,default:!1},showActive:{type:Boolean,default:!1},beforeUpload:{type:Function},onProgress:{type:Function},onSuccess:{type:Function},onError:{type:Function},onChange:{type:Function},onRemove:{type:Function},headers:{type:Object},name:{type:String,default:"file"},data:{type:Object},withCredentials:{type:Boolean,default:!1},accept:{type:String}},emits:["update:fileList","update:activeIndex"],setup(i,{emit:g}){const t=i;t.showActive&&t.activeIndex==null&&console.error("未绑定activeIndex");const h=L(!1),C=L(0),f=Z(()=>t.fileList.map(s=>s.src));let l="add",p;const n=L(),d=()=>{I(n).click()},m=s=>{const e=s.target.files;e&&(P(e),I(n).value="")},P=s=>{Array.from(s).forEach(r=>{if(!t.beforeUpload){A(r);return}const a=t.beforeUpload(r);a&&(a instanceof Promise&&a.then(x=>A(x)),A(r))})},D=(s,e)=>{const r=t.fileList.map(a=>a.uid===s.uid?{...a,...e}:a);g("update:fileList",r)},A=s=>{const e={uid:Date.now()+"upload-file",name:s.name,size:s.size,percent:0,status:"ready",raw:s,src:"",response:null},r=new FileReader;r.readAsDataURL(s),r.onload=a=>{var j;const x=(j=a.target)==null?void 0:j.result;e.src=x;const o=q(t.fileList);l=="add"&&o.push(e),l=="replace"&&(o[p]=e),g("update:fileList",o),l="add";const{name:v,data:k,action:J,headers:Q,withCredentials:X,onProgress:O,onSuccess:M,onError:V,onChange:_}=t,R=new FormData;R.append(v,s),k&&Object.keys(k).forEach(c=>R.append(c,k[c])),se.post(J,R,{headers:{...Q,"Content-Type":"multipart/form-data"},withCredentials:X,onUploadProgress:c=>{const z=Math.round(c.loaded*100/c.total)||0;D(e,{percent:z,status:"uploading"}),e.status="uploading",e.percent=z,O&&O(z,e)}}).then(c=>{console.log("--成功--",c),D(e,{status:"success",response:c.data}),e.status="success",e.response=c.data,M&&M(c.data,e),_&&_(e)}).catch(c=>{console.log("err",c),D(e,{status:"error",error:c}),e.status="error",e.error=c,V&&V(c,e),_&&_(e)})}},W=s=>{p=s,l="replace",d()},N=s=>{const e=q(t.fileList);if(t.showActive){const a=s<t.activeIndex,x=!!(s==t.activeIndex&&s==e.length-1&&e[s-1]);if(a||x){let o=t.activeIndex;o--,g("update:activeIndex",o)}}const r=e.splice(s,1);g("update:fileList",e),t.onRemove&&t.onRemove(r[0])},G=s=>{C.value=s,h.value=!0};return(s,e)=>{const r=$("el-progress"),a=$("iconify"),x=$("img-viewer");return u(),y("div",le,[(u(!0),y(T,null,ee(i.fileList,(o,v)=>(u(),y("div",{key:o.uid,class:K(["uploaded",{active:i.showActive&&i.activeIndex==v}]),onClick:k=>i.showActive&&g("update:activeIndex",v)},[["ready","uploading"].includes(o.status)?(u(),B(r,{key:0,type:"circle",percentage:o.percent},null,8,["percentage"])):b("",!0),["success",void 0].includes(o.status)?(u(),y(T,{key:1},[F("img",{class:"img",src:o.src},null,8,re),i.showReplace?(u(),y("div",{key:0,class:"replace-box",onClick:U(k=>W(v),["stop"])}," 替换图片 ",8,de)):b("",!0),i.showActive&&i.activeIndex==v?(u(),y("div",{key:1,class:"select-del-icon",onClick:U(k=>N(v),["stop"])},[w(a,{icon:"close"})],8,ue)):b("",!0),v!==i.activeIndex?(u(),y("div",{key:2,class:"hover-del-icon",onClick:U(k=>N(v),["stop"])},[w(a,{icon:"delete"})],8,pe)):b("",!0),F("div",{class:"hover-preview-icon",onClick:U(k=>G(v),["stop"])},[w(a,{icon:"zoom-in"})],8,fe)],64)):b("",!0),["error"].includes(o.status)?(u(),B(r,{key:2,type:"circle",percentage:o.percent,status:"exception"},null,8,["percentage"])):b("",!0)],10,ce))),128)),i.fileList.length<i.maxLength?(u(),B(ie,{key:0,onFile:o=>P(o)},{default:te(()=>[F("div",{class:"upload",onClick:d},[w(a,{icon:"plus"})])]),_:1},8,["onFile"])):b("",!0),F("input",{class:"file-input",style:{display:"none"},ref_key:"fileInputRef",ref:n,onChange:m,type:"file",accept:i.accept,multiple:!1},null,40,ve),w(x,{visible:h.value,"onUpdate:visible":e[0]||(e[0]=o=>h.value=o),imgList:f.value,initIndex:C.value},null,8,["visible","imgList","initIndex"])])}}}),he=E(ge,[["__scopeId","data-v-d2274ecb"]]),me={class:"page-box bg-white dark:bg-dark p-4"},ye=S({__name:"gkUpload",setup(i){const g="http://xxxxxx/xx"+ne,t=L([]),h=L(0),C=n=>n.size/1024>12e3?(console.log("file-to-big 超过了12M"),!1):!0,f=n=>{console.log("onFileChange-size",n.size/1024)},l=(n,d)=>{String(n==null?void 0:n.code).startsWith("200")||(H.error((n==null?void 0:n.msg)||"上传失败"),t.value=I(t).filter(m=>m.uid!==d.uid))},p=(n,d)=>{H.error("上传失败"),t.value=I(t).filter(m=>m.uid!==d.uid)};return(n,d)=>(u(),y("div",me,[w(he,{"file-list":t.value,"onUpdate:fileList":d[0]||(d[0]=m=>t.value=m),"active-index":h.value,"onUpdate:activeIndex":d[1]||(d[1]=m=>h.value=m),action:g,"before-upload":C,"on-change":f,"on-success":l,"on-error":p,headers:I(oe),showReplace:"",showActive:""},null,8,["file-list","active-index","headers"])]))}}),be=E(ye,[["__scopeId","data-v-014964bc"]]);export{be as default};
