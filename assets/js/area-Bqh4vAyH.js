import{g as C}from"./common-DN-ZbiLi.js";import{d as B,aK as y,aw as I,bH as K,bp as z,aP as x,o as f,b as V,I as _,bu as b,F as L,aN as N,a as P,aI as $,w as p,b1 as j}from"./index-ClfDdxmO.js";import"./index-uGdeCMGa.js";const E={class:"flex align-center gap-2.5"},F=B({name:"areaSelect",__name:"areaSelect",props:{modelValue:{type:Object,default:()=>({})},provinceKey:{type:String,default:"provinceCode"},cityKey:{type:String,default:"cityCode"},countyKey:{type:String,default:"countyCode"}},emits:["change"],setup(S,{emit:h}){const t=S,u=y(""),r=y(""),i=y(""),m=y([]),e=y([]),l=y([]),c=y(!1),n=y(!1),v=y(!1);I(()=>{O()});async function O(){try{c.value=!0;const{code:d,data:o,msg:a}=await C({level:0});if(!String(d).startsWith("2"))return K.error(a||"查询省级区域失败");m.value=o}finally{c.value=!1}}z(()=>t.modelValue,(d,o)=>{d&&(Object.keys(d).length&&(u.value=d[t.provinceKey],r.value=d[t.cityKey],i.value=d[t.countyKey]),u.value&&!o&&(n.value=!0,C({level:1,pcode:u.value}).then(a=>{if(!String(a.code).startsWith("2"))return K.error(a.msg||"查询市级区域失败");e.value=a.data}).finally(()=>{n.value=!1})),r.value&&!o&&(v.value=!0,C({level:2,pcode:r.value}).then(a=>{if(!String(a.code).startsWith("2"))return K.error(a.msg||"查询区级区域失败");l.value=a.data}).finally(()=>{v.value=!1})))},{immediate:!0});const U=async d=>{if(d)try{n.value=!0,e.value=[];const{code:o,data:a,msg:g}=await C({level:1,pcode:u.value});if(!String(o).startsWith("2"))return K.error(g||"查询市级区域失败");e.value=a}finally{n.value=!1}r.value="",i.value="",W()},k=async d=>{if(d)try{v.value=!0,l.value=[];const{code:o,data:a,msg:g}=await C({level:2,pcode:r.value});if(!String(o).startsWith("2"))return K.error(g||"查询区级区域失败");l.value=a}finally{v.value=!1}i.value="",W()},D=()=>{W()},W=()=>{const{provinceKey:d,cityKey:o,countyKey:a}=t,g={[d]:u.value,[o]:r.value,[a]:i.value};t.modelValue[d]=u.value,t.modelValue[o]=r.value,t.modelValue[a]=i.value,h("change",g)};return(d,o)=>{const a=x("el-option"),g=x("el-select");return f(),V("div",E,[_(g,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),placeholder:"省",clearable:"",onChange:U,filterable:"",loading:c.value,"loading-text":"加载中..."},{default:b(()=>[(f(!0),V(L,null,N(m.value,s=>(f(),P(a,{key:s.code,label:s.name,value:s.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),_(g,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=s=>r.value=s),placeholder:"市",clearable:"",disabled:!u.value,onChange:k,filterable:"",loading:n.value,"loading-text":"加载中..."},{default:b(()=>[(f(!0),V(L,null,N(e.value,s=>(f(),P(a,{key:s.code,label:s.name,value:s.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"]),_(g,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=s=>i.value=s),placeholder:"区",clearable:"",disabled:!u.value||!r.value,onChange:D,filterable:"",loading:v.value,"loading-text":"加载中..."},{default:b(()=>[(f(!0),V(L,null,N(l.value,s=>(f(),P(a,{key:s.code,label:s.name,value:s.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"])])}}}),M=B({name:"areaCascader",__name:"areaCascader",props:{modelValue:{type:Object,default:()=>({})},provinceKey:{type:String,default:"provinceCode"},cityKey:{type:String,default:"cityCode"},countyKey:{type:String,default:"countyCode"}},emits:["change"],setup(S,{emit:h}){const t=S,u=y([]);z(()=>t.modelValue,(e,l)=>{const{provinceKey:c,cityKey:n,countyKey:v}=t;e&&Object.keys(e).length&&!l&&e[c]&&e[n]&&e[v]&&(u.value=[e[c],e[n],e[v]])},{immediate:!0});const r={lazy:!0,async lazyLoad(e,l){const{level:c}=e,n={level:c};console.log("node",e),c>=1&&(n.pcode=e.value);const v=await i(n);l(v)}};function i(e){return new Promise(async(l,c)=>{try{const{code:n,data:v,msg:O}=await C(e);String(n).startsWith("2")||(K.error(O||`查询${["省","市","区"][e.level]}级区域失败`),c([]));const U=v.map(k=>({label:k.name,value:k.code,leaf:e.level>=2}));l(U)}finally{c([])}})}const m=e=>{if(!(e!=null&&e.length))return;const{provinceKey:l,cityKey:c,countyKey:n}=t,v={provinceKey:e[0],cityKey:e[1],countyKey:e[2]};t.modelValue[l]=e[0],t.modelValue[c]=e[1],t.modelValue[n]=e[2],h("change",v)};return(e,l)=>{const c=x("el-cascader");return f(),V("div",null,[_(c,{props:r,modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=n=>u.value=n),onChange:m},null,8,["modelValue"])])}}}),H=p("span",null,"省市区(下拉选择)",-1),q={class:"mt-2"},A=p("div",null,"v-model绑定的数据：",-1),G={class:"mt-2"},J=p("span",null,"省市区(级联选择)",-1),Q={class:"mt-2"},R=p("div",null,"v-model绑定的数据：",-1),T={class:"mt-2"},w=B({__name:"area",setup(S){const h=$({key1:"test-1",key2:"test-2"}),t=$({key1:"test-a",key2:"test-b",provinceCode:"230000",cityCode:"230300",countyCode:"230305"}),u=i=>{console.log("data1",i)},r=i=>{console.log("data2",i)};return(i,m)=>{const e=x("el-card");return f(),V("div",null,[_(e,null,{header:b(()=>[H]),default:b(()=>[p("div",null,[_(F,{modelValue:h,"onUpdate:modelValue":m[0]||(m[0]=l=>h=l),onChange:u},null,8,["modelValue"]),p("div",q,[A,p("div",G,j(h),1)])])]),_:1}),_(e,{class:"mt-4"},{header:b(()=>[J]),default:b(()=>[p("div",null,[_(M,{modelValue:t,"onUpdate:modelValue":m[1]||(m[1]=l=>t=l),onChange:r},null,8,["modelValue"]),p("div",Q,[R,p("div",T,j(t),1)])])]),_:1})])}}});export{w as default};
